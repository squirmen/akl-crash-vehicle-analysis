<!DOCTYPE html>
<html>
<head>
    <title>Crash-Involved Vehicle - Trip rLIyF5Bi7L</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { height: 100vh; width: 100vw; }
        .legend {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            font-size: 12px;
        }
        .legend-title { font-weight: bold; margin-bottom: 5px; font-size: 14px; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        var map = L.map('map').setView([-36.877751034482756, 174.7293410344828], 16);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        function getColor(speed, atCrashScene) {
            if (atCrashScene) return '#ff00ff';  // Magenta for crash scene points
            var kmh = speed * 1.60934;
            return kmh > 100 ? '#00ff00' :
                   kmh > 80  ? '#66ff33' :
                   kmh > 60  ? '#ccff33' :
                   kmh > 40  ? '#ffff00' :
                   kmh > 20  ? '#ffcc00' :
                   kmh > 10  ? '#ff6600' :
                                '#ff0000';
        }

        var crashSceneIndices = [37, 38, 39, 40, 41, 42, 43];

        var points = [
            {lat: -36.86004517241379, lon: 174.76853793103447, time: '2025-01-02 13:14:38', speed: 8.0, idx: 0, atScene: false},
            {lat: -36.85972103448276, lon: 174.76806482758622, time: '2025-01-02 13:14:54', speed: 9.0, idx: 1, atScene: false},
            {lat: -36.85970896551724, lon: 174.76803586206898, time: '2025-01-02 13:14:55', speed: 0.0, idx: 2, atScene: false},
            {lat: -36.85960103448276, lon: 174.76780689655175, time: '2025-01-02 13:16:07', speed: 4.0, idx: 3, atScene: false},
            {lat: -36.859582068965516, lon: 174.767785862069, time: '2025-01-02 13:16:20', speed: 6.0, idx: 4, atScene: false},
            {lat: -36.85901310344828, lon: 174.7681720689655, time: '2025-01-02 13:16:31', speed: 39.0, idx: 5, atScene: false},
            {lat: -36.85702206896552, lon: 174.7693951724138, time: '2025-01-02 13:16:56', speed: 42.0, idx: 6, atScene: false},
            {lat: -36.8563, lon: 174.7696779310345, time: '2025-01-02 13:17:07', speed: 3.0, idx: 7, atScene: false},
            {lat: -36.856265862068966, lon: 174.76968689655172, time: '2025-01-02 13:17:25', speed: 11.0, idx: 8, atScene: false},
            {lat: -36.85573413793104, lon: 174.76960206896553, time: '2025-01-02 13:17:35', speed: 19.0, idx: 9, atScene: false},
            {lat: -36.85759896551724, lon: 174.76788689655172, time: '2025-01-02 13:17:54', speed: 72.0, idx: 10, atScene: false},
            {lat: -36.85887586206896, lon: 174.7669479310345, time: '2025-01-02 13:18:02', speed: 75.0, idx: 11, atScene: false},
            {lat: -36.85954586206896, lon: 174.76645586206894, time: '2025-01-02 13:18:06', speed: 77.0, idx: 12, atScene: false},
            {lat: -36.86066689655173, lon: 174.76523896551726, time: '2025-01-02 13:18:14', speed: 74.0, idx: 13, atScene: false},
            {lat: -36.860994827586204, lon: 174.76394793103447, time: '2025-01-02 13:18:20', speed: 72.0, idx: 14, atScene: false},
            {lat: -36.86076, lon: 174.7623289655172, time: '2025-01-02 13:18:27', speed: 76.0, idx: 15, atScene: false},
            {lat: -36.86006413793103, lon: 174.76032896551726, time: '2025-01-02 13:18:36', speed: 74.0, idx: 16, atScene: false},
            {lat: -36.860581034482756, lon: 174.75745586206898, time: '2025-01-02 13:18:48', speed: 82.0, idx: 17, atScene: false},
            {lat: -36.86192206896552, lon: 174.75517689655175, time: '2025-01-02 13:18:59', speed: 81.0, idx: 18, atScene: false},
            {lat: -36.863334137931034, lon: 174.75295793103447, time: '2025-01-02 13:19:10', speed: 83.0, idx: 19, atScene: false},
            {lat: -36.86500413793104, lon: 174.75106103448275, time: '2025-01-02 13:19:21', speed: 81.0, idx: 20, atScene: false},
            {lat: -36.86676482758621, lon: 174.74906896551727, time: '2025-01-02 13:19:33', speed: 78.0, idx: 21, atScene: false},
            {lat: -36.868281034482756, lon: 174.7468368965517, time: '2025-01-02 13:19:45', speed: 77.0, idx: 22, atScene: false},
            {lat: -36.86896310344827, lon: 174.74456896551726, time: '2025-01-02 13:19:55', speed: 78.0, idx: 23, atScene: false},
            {lat: -36.86900310344828, lon: 174.74166310344827, time: '2025-01-02 13:20:07', speed: 78.0, idx: 24, atScene: false},
            {lat: -36.86873103448276, lon: 174.73874103448276, time: '2025-01-02 13:20:19', speed: 74.0, idx: 25, atScene: false},
            {lat: -36.868444137931036, lon: 174.73593103448275, time: '2025-01-02 13:20:31', speed: 73.0, idx: 26, atScene: false},
            {lat: -36.86826586206897, lon: 174.7330110344828, time: '2025-01-02 13:20:44', speed: 70.0, idx: 27, atScene: false},
            {lat: -36.868582068965516, lon: 174.7301879310345, time: '2025-01-02 13:20:57', speed: 70.0, idx: 28, atScene: false},
            {lat: -36.869142068965516, lon: 174.72726896551723, time: '2025-01-02 13:21:11', speed: 65.0, idx: 29, atScene: false},
            {lat: -36.86917, lon: 174.72613103448276, time: '2025-01-02 13:21:18', speed: 32.0, idx: 30, atScene: false},
            {lat: -36.869186896551724, lon: 174.72604689655174, time: '2025-01-02 13:21:19', speed: 25.0, idx: 31, atScene: false},
            {lat: -36.87148, lon: 174.72562689655172, time: '2025-01-02 13:21:39', speed: 68.0, idx: 32, atScene: false},
            {lat: -36.87381, lon: 174.72564103448275, time: '2025-01-02 13:21:52', speed: 70.0, idx: 33, atScene: false},
            {lat: -36.87611413793103, lon: 174.7259079310345, time: '2025-01-02 13:22:08', speed: 61.0, idx: 34, atScene: false},
            {lat: -36.877187931034484, lon: 174.72651517241377, time: '2025-01-02 13:22:15', speed: 68.0, idx: 35, atScene: false},
            {lat: -36.878393103448275, lon: 174.72813103448277, time: '2025-01-02 13:22:36', speed: 23.0, idx: 36, atScene: false},
            {lat: -36.877703103448276, lon: 174.72922103448275, time: '2025-01-02 13:22:51', speed: 11.0, idx: 37, atScene: true},
            {lat: -36.877751034482756, lon: 174.7293410344828, time: '2025-01-02 13:22:56', speed: 7.0, idx: 38, atScene: true},
            {lat: -36.877815862068964, lon: 174.72939103448277, time: '2025-01-02 13:22:59', speed: 0.0, idx: 39, atScene: true},
            {lat: -36.87790482758621, lon: 174.72941517241378, time: '2025-01-02 13:32:49', speed: 6.0, idx: 40, atScene: true},
            {lat: -36.87795, lon: 174.72946517241377, time: '2025-01-02 13:32:52', speed: 4.0, idx: 41, atScene: true},
            {lat: -36.87807103448276, lon: 174.72960103448276, time: '2025-01-02 13:33:09', speed: 5.0, idx: 42, atScene: true},
            {lat: -36.87812103448276, lon: 174.72965896551722, time: '2025-01-02 13:33:12', speed: 4.0, idx: 43, atScene: true},
            {lat: -36.87817206896552, lon: 174.729714137931, time: '2025-01-02 13:33:20', speed: 7.0, idx: 44, atScene: false},
            {lat: -36.87897206896552, lon: 174.73002896551725, time: '2025-01-02 13:33:54', speed: 13.0, idx: 45, atScene: false},
            {lat: -36.87913103448276, lon: 174.72991206896552, time: '2025-01-02 13:34:01', speed: 3.0, idx: 46, atScene: false},
            {lat: -36.87920413793103, lon: 174.7298079310345, time: '2025-01-02 13:34:11', speed: 6.0, idx: 47, atScene: false},
            {lat: -36.87924206896552, lon: 174.72973310344827, time: '2025-01-02 13:34:16', speed: 0.0, idx: 48, atScene: false},
            {lat: -36.87926413793103, lon: 174.72969413793106, time: '2025-01-02 13:34:19', speed: 7.0, idx: 49, atScene: false},
            {lat: -36.87944896551724, lon: 174.72938482758622, time: '2025-01-02 13:34:34', speed: 4.0, idx: 50, atScene: false},
            {lat: -36.87945517241379, lon: 174.72937310344827, time: '2025-01-02 13:34:36', speed: 5.0, idx: 51, atScene: false},
            {lat: -36.87961310344828, lon: 174.7291479310345, time: '2025-01-02 13:34:49', speed: 4.0, idx: 52, atScene: false},
            {lat: -36.87962689655173, lon: 174.72914896551725, time: '2025-01-02 13:34:50', speed: 5.0, idx: 53, atScene: false},
            {lat: -36.88146, lon: 174.73088517241382, time: '2025-01-02 13:35:18', speed: 40.0, idx: 54, atScene: false},
            {lat: -36.88344310344828, lon: 174.73243517241377, time: '2025-01-02 13:35:43', speed: 41.0, idx: 55, atScene: false},
            {lat: -36.88393896551724, lon: 174.73315689655175, time: '2025-01-02 13:35:50', speed: 43.0, idx: 56, atScene: false},
            {lat: -36.88431310344828, lon: 174.73464689655174, time: '2025-01-02 13:36:02', speed: 37.0, idx: 57, atScene: false},
            {lat: -36.88441206896552, lon: 174.73522413793103, time: '2025-01-02 13:36:11', speed: 0.0, idx: 58, atScene: false},
            {lat: -36.884421034482756, lon: 174.73525517241382, time: '2025-01-02 13:37:04', speed: 7.0, idx: 59, atScene: false},
            {lat: -36.88497896551724, lon: 174.73798413793105, time: '2025-01-02 13:37:32', speed: 28.0, idx: 60, atScene: false},
            {lat: -36.88498689655172, lon: 174.73835517241378, time: '2025-01-02 13:37:40', speed: 9.0, idx: 61, atScene: false},
            {lat: -36.882815862068966, lon: 174.73916000000003, time: '2025-01-02 13:38:05', speed: 44.0, idx: 62, atScene: false},
            {lat: -36.880615862068964, lon: 174.73985896551721, time: '2025-01-02 13:38:24', speed: 50.0, idx: 63, atScene: false},
            {lat: -36.87843, lon: 174.74056000000002, time: '2025-01-02 13:38:43', speed: 44.0, idx: 64, atScene: false},
            {lat: -36.876243103448274, lon: 174.74126793103449, time: '2025-01-02 13:39:14', speed: 40.0, idx: 65, atScene: false},
            {lat: -36.87403310344828, lon: 174.74206206896554, time: '2025-01-02 13:39:35', speed: 43.0, idx: 66, atScene: false},
            {lat: -36.87349689655172, lon: 174.74265310344828, time: '2025-01-02 13:39:42', speed: 40.0, idx: 67, atScene: false},
            {lat: -36.872856896551724, lon: 174.74398206896552, time: '2025-01-02 13:39:54', speed: 40.0, idx: 68, atScene: false},
            {lat: -36.87268896551724, lon: 174.7446731034483, time: '2025-01-02 13:40:00', speed: 38.0, idx: 69, atScene: false},
            {lat: -36.87294, lon: 174.74626689655173, time: '2025-01-02 13:40:13', speed: 36.0, idx: 70, atScene: false},
            {lat: -36.87255482758621, lon: 174.74683103448274, time: '2025-01-02 13:40:20', speed: 34.0, idx: 71, atScene: false},
            {lat: -36.87172586206896, lon: 174.7470320689655, time: '2025-01-02 13:40:36', speed: 3.0, idx: 72, atScene: false},
            {lat: -36.87169586206897, lon: 174.74703689655172, time: '2025-01-02 13:41:07', speed: 11.0, idx: 73, atScene: false},
            {lat: -36.86984586206896, lon: 174.74876793103448, time: '2025-01-02 13:41:36', speed: 38.0, idx: 74, atScene: false},
            {lat: -36.86911689655172, lon: 174.7499079310345, time: '2025-01-02 13:41:48', speed: 40.0, idx: 75, atScene: false},
            {lat: -36.86836413793103, lon: 174.75260413793103, time: '2025-01-02 13:42:09', speed: 45.0, idx: 76, atScene: false},
            {lat: -36.86768793103448, lon: 174.75537517241378, time: '2025-01-02 13:42:29', speed: 42.0, idx: 77, atScene: false},
            {lat: -36.867093103448276, lon: 174.75654586206895, time: '2025-01-02 13:42:41', speed: 20.0, idx: 78, atScene: false},
            {lat: -36.86699310344827, lon: 174.75669, time: '2025-01-02 13:42:46', speed: 2.0, idx: 79, atScene: false},
            {lat: -36.866973103448274, lon: 174.75672206896553, time: '2025-01-02 13:42:54', speed: 10.0, idx: 80, atScene: false},
            {lat: -36.866092068965514, lon: 174.7579279310345, time: '2025-01-02 13:43:12', speed: 27.0, idx: 81, atScene: false},
            {lat: -36.86576310344827, lon: 174.75961103448276, time: '2025-01-02 13:43:31', speed: 31.0, idx: 82, atScene: false},
            {lat: -36.865167931034485, lon: 174.76039103448278, time: '2025-01-02 13:43:52', speed: 4.0, idx: 83, atScene: false},
            {lat: -36.86514689655172, lon: 174.76042310344826, time: '2025-01-02 13:44:17', speed: 7.0, idx: 84, atScene: false},
            {lat: -36.86429517241379, lon: 174.76086586206895, time: '2025-01-02 13:44:31', speed: 34.0, idx: 85, atScene: false},
            {lat: -36.86206103448276, lon: 174.76146793103447, time: '2025-01-02 13:44:55', speed: 40.0, idx: 86, atScene: false},
            {lat: -36.85941689655172, lon: 174.76293586206896, time: '2025-01-02 13:45:23', speed: 42.0, idx: 87, atScene: false},
            {lat: -36.85884310344827, lon: 174.76326999999998, time: '2025-01-02 13:45:35', speed: 4.0, idx: 88, atScene: false},
            {lat: -36.858794137931035, lon: 174.7633079310345, time: '2025-01-02 13:45:44', speed: 6.0, idx: 89, atScene: false},
            {lat: -36.858431034482756, lon: 174.7636020689655, time: '2025-01-02 13:45:55', speed: 21.0, idx: 90, atScene: false},
            {lat: -36.85972689655173, lon: 174.76590103448274, time: '2025-01-02 13:46:23', speed: 33.0, idx: 91, atScene: false},
            {lat: -36.86027482758621, lon: 174.76682, time: '2025-01-02 13:46:39', speed: 3.0, idx: 92, atScene: false},
            {lat: -36.859534137931036, lon: 174.767695862069, time: '2025-01-02 13:47:07', speed: 0.0, idx: 93, atScene: false},
            {lat: -36.859507931034486, lon: 174.76776586206898, time: '2025-01-02 13:47:12', speed: 10.0, idx: 94, atScene: false},
            {lat: -36.85994310344827, lon: 174.76858896551727, time: '2025-01-02 13:47:30', speed: 11.0, idx: 95, atScene: false},
            {lat: -36.86016, lon: 174.768595862069, time: '2025-01-02 13:47:39', speed: 4.0, idx: 96, atScene: false},
            {lat: -36.860175862068964, lon: 174.76857896551724, time: '2025-01-02 13:47:40', speed: 5.0, idx: 97, atScene: false},
            {lat: -36.86029793103448, lon: 174.7685668965517, time: '2025-01-02 13:47:44', speed: 4.0, idx: 98, atScene: false},
        ];

        points.forEach(function(point, idx) {
            var color = getColor(point.speed, point.atScene);
            var radius = point.atScene ? 8 : 4;  // Larger for crash scene points
            var marker = L.circleMarker([point.lat, point.lon], {
                radius: radius,
                fillColor: color,
                color: point.atScene ? '#ff00ff' : '#000',
                weight: point.atScene ? 2 : 1,
                opacity: 1,
                fillOpacity: point.atScene ? 1 : 0.8
            }).addTo(map);

            var crashInfo = point.atScene ? '<br><b style="color: #ff00ff;">AT CRASH SCENE</b>' : '';
            marker.bindPopup(
                '<b>Point ' + point.idx + '</b>' + crashInfo + '<br>' +
                'Time: ' + point.time + '<br>' +
                'Speed: ' + point.speed + ' mph (' + (point.speed * 1.60934).toFixed(1) + ' km/h)'
            );

            if (point.atScene) {
                marker.bindTooltip('At crash scene', {permanent: false, direction: 'top'});
            }
        });

        // Draw path
        var latlngs = points.map(p => [p.lat, p.lon]);
        var polyline = L.polyline(latlngs, {color: 'blue', weight: 2, opacity: 0.5}).addTo(map);

        // Add crash marker
        var crashMarker = L.marker([-36.877788029000136, 174.72932358473406], {
            icon: L.icon({
                iconUrl: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSJyZWQiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTEyIDJDOC4xMyAyIDUgNS4xMyA1IDljMCA1LjI1IDcgMTMgNyAxM3M3LTcuNzUgNy0xM2MwLTMuODctMy4xMy03LTctN3ptMCA5LjVjLTEuMzggMC0yLjUtMS4xMi0yLjUtMi41czEuMTItMi41IDIuNS0yLjUgMi41IDEuMTIgMi41IDIuNS0xLjEyIDIuNS0yLjUgMi41eiIvPjwvc3ZnPg==',
                iconSize: [40, 40],
                iconAnchor: [20, 40],
                popupAnchor: [0, -40]
            })
        }).addTo(map);

        crashMarker.bindPopup(
            '<div style="min-width: 250px;"><b style="font-size: 16px;">ð CRASH LOCATION</b><br><hr>' +
            '<b>Crash ID:</b> 2025315483<br>' +
            '<b>Time:</b> 2025-01-02 13:20<br>' +
            '<b>Severity:</b> Minor Crash<br>' +
            '<b>Location:</b> Mount Albert<br>' +
            '<b>Road:</b> ATAWHAI LANE<br>' +
            '<hr><b style="color: #ff00ff;">VEHICLE INVOLVEMENT:</b><br>' +
            'Type: LCV<br>' +
            'Distance: 4.389882709884019m<br>' +
            'Time at scene: <b>13.2 minutes</b><br>' +
            'GPS points at scene: <b>6</b><br>' +
            'Avg speed at scene: <b>4.3 mph</b><br>' +
            '<hr><b>â ï¸ Vehicle likely INVOLVED or stopped to assist</b></div>'
        ).openPopup();

        // Add legend
        var legend = L.control({position: 'topright'});
        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'legend');
            div.innerHTML = '<div class="legend-title">ð Crash-Involved Vehicle</div><hr>';
            div.innerHTML += '<div style="background: #ff00ff; width: 16px; height: 16px; border-radius: 50%; display: inline-block; border: 2px solid #ff00ff;"></div> <b>At crash scene (7 points)</b><br><br>';
            div.innerHTML += '<div class="legend-title">Speed (km/h)</div>';
            div.innerHTML += '<div style="background: #00ff00; width: 15px; height: 15px; display: inline-block;"></div> > 100<br>';
            div.innerHTML += '<div style="background: #ccff33; width: 15px; height: 15px; display: inline-block;"></div> 60-80<br>';
            div.innerHTML += '<div style="background: #ffff00; width: 15px; height: 15px; display: inline-block;"></div> 40-60<br>';
            div.innerHTML += '<div style="background: #ffcc00; width: 15px; height: 15px; display: inline-block;"></div> 20-40<br>';
            div.innerHTML += '<div style="background: #ff0000; width: 15px; height: 15px; display: inline-block;"></div> < 10<br>';
            div.innerHTML += '<hr><b>Trip Summary:</b><br>';
            div.innerHTML += 'Duration: 33 min<br>';
            div.innerHTML += 'Distance: 7.7 miles<br>';
            div.innerHTML += 'Max speed: 83 mph<br>';
            div.innerHTML += '<br><b style="color: red;">â ï¸ Stopped at crash scene<br>for 13.2 minutes</b>';
            return div;
        };
        legend.addTo(map);

        // Add start/end markers
        L.marker([-36.86004517241379, 174.76853793103447], {
            icon: L.icon({
                iconUrl: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iOCIgZmlsbD0iZ3JlZW4iIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIvPjx0ZXh0IHg9IjEyIiB5PSIxNiIgZm9udC1zaXplPSIxMiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPnM8L3RleHQ+PC9zdmc+',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            })
        }).addTo(map).bindPopup('<b>START</b><br>Time: 2025-01-02 13:14:38');

        L.marker([-36.86029793103448, 174.7685668965517], {
            icon: L.icon({
                iconUrl: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iOCIgZmlsbD0iYmxhY2siIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIvPjx0ZXh0IHg9IjEyIiB5PSIxNiIgZm9udC1zaXplPSIxMiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPmU8L3RleHQ+PC9zdmc+',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            })
        }).addTo(map).bindPopup('<b>END</b><br>Time: 2025-01-02 13:47:44');

        // Fit to crash scene
        var crashSceneBounds = L.latLngBounds(
            points.filter(p => p.atScene).map(p => [p.lat, p.lon])
        );
        if (crashSceneBounds.isValid()) {
            map.fitBounds(crashSceneBounds.pad(0.3));
        }

    </script>
</body>
</html>